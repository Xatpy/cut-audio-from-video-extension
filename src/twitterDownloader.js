const downloadVideo = function (url, name) {
  return fetch(url)
    .then(function (response) {
      return response.blob();
    })
    .then(function (response) {
      const newLink = `https://cut-audio-from-video.com?url=${url}`;
      const element = document.createElement("a");
      element.style.display = "none";
      document.body.appendChild(element);
      element.href = window.URL.createObjectURL(response);
      element.setAttribute("target", "_blank");
      //element.setAttribute("download", `${name}.mp4`);
      element.setAttribute("href", newLink);
      element.click();
      // window.URL.revokeObjectURL(element.href);
      // document.body.removeChild(element);
    });
};

const onRequestDone = function (callback) {
  const xhrOpen = XMLHttpRequest.prototype.open;

  XMLHttpRequest.prototype.open = function (_, requestUrl) {
    if (
      /(api\.)?twitter\.com\/(i\/api\/)?(2|graphql|1\.1)\//i.test(requestUrl)
    ) {
      const xhrSend = this.send;
      this.send = function () {
        const xhrStateChange = this.onreadystatechange;
        this.onreadystatechange = function () {
          const { readyState, responseText } = this;
          if (readyState === XMLHttpRequest.DONE && responseText) {
            try {
              callback(JSON.parse(responseText));
            } catch (e) {
              console.log(e);
            }
          }
          return xhrStateChange.apply(this, arguments);
        };
        return xhrSend.apply(this, arguments);
      };
    }
    return xhrOpen.apply(this, arguments);
  };
};

const observeDom = function (callback) {
  const observer = new MutationObserver(function (mutations) {
    mutations.forEach(function (mutation) {
      mutation.addedNodes.forEach(function ($element) {
        if ($element instanceof HTMLElement === false) {
          return false;
        }
        if ($element.nodeName === "IMG") {
          const $container = $element.closest("article[role='article']");
          if ($container) {
            const $group = $container.querySelector(
              "[role='group']:last-child"
            );
            if ($group) {
              callback({
                $image: $element,
                $group: $group,
              });
            }
          }
        }
      });
    });
  });
  observer.observe(document, { childList: true, subtree: true });
};

function find(source, key, list = []) {
  if (!source) {
    return list;
  }

  if (typeof source !== "object") {
    return list;
  }

  if (typeof source[key] !== "undefined") {
    list.push(source);
  } else {
    Object.values(source).forEach(function (deep) {
      list.push(...find(deep, key));
    });
  }

  return list;
}

function textify(entity) {
  const entityId = entity.id_str || entity.conversation_id_str;

  if (!entity.full_text) {
    return entityId;
  }

  let text = entity.full_text
    .split("https://t.co")[0]
    .trim()
    .replace(/(\r\n|\n|\r)/gm, "")
    .substr(0, 50);

  if (!text) {
    text = entityId;
  }

  return text;
}

function checkMediaHasVideo(media) {
  return media.type === "video" || media.type === "animated_gif";
}

const parseRequest = function (response) {
  // tweet entites
  const entities = [...find(response, "extended_entities")];

  // tweet card entites
  const cards = [...find(response, "string_value")]
    .map(function (value) {
      try {
        const parsedValue = JSON.parse(value.string_value);
        const mediaEntity = Object.values(parsedValue.media_entities)
          .filter(function (media) {
            return ["video", "animated_gif"].indexOf(media.type) > -1;
          })
          .shift();
        if (mediaEntity) {
          return {
            extended_entities: {
              media: [mediaEntity],
            },
            id_str: mediaEntity.id_str,
          };
        }
      } catch (e) {
        return false;
      }
      return false;
    })
    .filter(Boolean);

  return [...cards, ...entities]
    .filter(function (entity) {
      return entity.extended_entities.media.filter(checkMediaHasVideo).length;
    })
    .flatMap(function (entity) {
      const entityId = entity.id_str || entity.conversation_id_str;
      const {
        extended_entities: { media },
      } = entity;
      return media.filter(checkMediaHasVideo).map(function (item) {
        const video = item.video_info.variants
          .filter(function (variant) {
            return variant.content_type === "video/mp4";
          })
          .sort(function (first, second) {
            return second.bitrate - first.bitrate;
          })
          .shift();
        return {
          id: item.id_str,
          entityId: entityId,
          photo: item.media_url_https.substr(
            0,
            item.media_url_https.lastIndexOf(".")
          ),
          video: video.url,
          text: textify(entity),
        };
      });
    })
    .filter(function (video, index, self) {
      return self.indexOf(video) === index;
    });
};

function twitterDownloaderMain() {
  const videoList = [];

  onRequestDone(function (response) {
    const requestVideos = parseRequest(response);
    if (requestVideos.length) {
      videoList.push(...requestVideos);
    }
  });

  const svgElement = `
    <div title="Open with cut-audio-from-video.com">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 23" version="1.1">
          <g id="surface1">
            <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 10.441406 0.914062 C 9.277344 1.117188 8.210938 1.523438 7.222656 2.148438 C 5.742188 3.089844 4.539062 4.605469 3.964844 6.257812 C 3.628906 7.21875 3.59375 7.484375 3.550781 9.269531 C 3.53125 10.152344 3.511719 10.882812 3.507812 10.882812 C 3.507812 10.886719 3.363281 10.957031 3.195312 11.035156 C 2.480469 11.371094 2.03125 12.199219 2.160156 12.941406 C 2.246094 13.449219 3.039062 16.320312 3.152344 16.53125 C 3.292969 16.800781 3.675781 17.167969 3.941406 17.296875 C 4.230469 17.4375 4.652344 17.53125 4.964844 17.519531 L 5.242188 17.507812 L 5.398438 17.714844 C 5.5 17.847656 5.660156 17.976562 5.859375 18.078125 C 6.140625 18.226562 6.203125 18.238281 6.550781 18.234375 C 7.238281 18.234375 7.742188 17.941406 8 17.402344 C 8.105469 17.179688 8.121094 17.101562 8.101562 16.765625 L 8.082031 16.378906 L 8.347656 16.289062 C 8.734375 16.160156 8.980469 16.085938 8.996094 16.109375 C 9.035156 16.152344 9.214844 16.578125 9.214844 16.625 C 9.214844 16.652344 9.082031 16.753906 8.921875 16.855469 C 8.355469 17.199219 7.742188 17.84375 7.421875 18.421875 C 7.335938 18.585938 7.308594 18.664062 7.347656 18.699219 C 7.386719 18.730469 7.421875 18.71875 7.460938 18.65625 C 7.765625 18.175781 8.027344 17.824219 8.273438 17.582031 C 8.574219 17.28125 9.183594 16.835938 9.292969 16.835938 C 9.328125 16.835938 9.398438 16.90625 9.457031 16.992188 C 9.601562 17.21875 9.847656 17.414062 10.203125 17.585938 L 10.511719 17.726562 L 10.511719 18.148438 C 10.511719 18.371094 10.53125 18.589844 10.550781 18.621094 C 10.578125 18.664062 11.210938 18.753906 11.578125 18.769531 C 11.597656 18.769531 11.621094 19.351562 11.625 20.066406 C 11.640625 21.261719 11.644531 21.367188 11.726562 21.378906 C 11.804688 21.394531 11.808594 21.3125 11.808594 20.089844 L 11.808594 18.78125 L 12.027344 18.75 C 12.476562 18.695312 12.433594 18.578125 12.433594 19.832031 C 12.433594 20.859375 12.4375 20.933594 12.519531 20.921875 C 12.589844 20.90625 12.601562 20.808594 12.613281 19.8125 C 12.625 18.824219 12.632812 18.71875 12.710938 18.691406 C 12.84375 18.640625 12.863281 18.578125 12.863281 18.148438 L 12.863281 17.726562 L 13.171875 17.585938 C 13.527344 17.414062 13.777344 17.21875 13.921875 16.992188 C 13.976562 16.90625 14.042969 16.835938 14.074219 16.835938 C 14.160156 16.835938 14.664062 17.179688 14.964844 17.453125 C 15.128906 17.597656 15.394531 17.914062 15.550781 18.140625 C 15.964844 18.746094 15.960938 18.742188 16.023438 18.703125 C 16.109375 18.652344 15.855469 18.21875 15.480469 17.769531 C 15.183594 17.40625 14.726562 17.019531 14.320312 16.777344 L 14.117188 16.652344 L 14.238281 16.390625 C 14.304688 16.242188 14.367188 16.117188 14.371094 16.109375 C 14.394531 16.089844 15.039062 16.289062 15.296875 16.398438 L 15.550781 16.507812 L 15.550781 16.84375 C 15.550781 17.667969 16.179688 18.230469 17.113281 18.234375 C 17.617188 18.238281 17.960938 18.085938 18.234375 17.742188 L 18.421875 17.507812 L 18.707031 17.519531 C 19.011719 17.53125 19.433594 17.4375 19.722656 17.296875 C 19.992188 17.167969 20.371094 16.792969 20.515625 16.519531 C 20.640625 16.289062 21.417969 13.472656 21.507812 12.929688 C 21.632812 12.183594 21.1875 11.375 20.46875 11.035156 C 20.300781 10.957031 20.160156 10.886719 20.15625 10.882812 C 20.152344 10.882812 20.132812 10.175781 20.113281 9.316406 C 20.074219 7.578125 20.019531 7.207031 19.699219 6.261719 C 18.738281 3.429688 16.066406 1.289062 12.988281 0.878906 C 12.402344 0.800781 11 0.824219 10.441406 0.914062 Z M 13.167969 1.425781 C 13.761719 1.523438 14.5 1.742188 15.070312 1.992188 C 16.980469 2.828125 18.511719 4.460938 19.179688 6.378906 C 19.46875 7.199219 19.539062 7.636719 19.570312 8.726562 C 19.585938 9.265625 19.589844 9.707031 19.574219 9.707031 C 19.566406 9.707031 19.472656 9.664062 19.367188 9.613281 C 19.265625 9.5625 19.109375 9.507812 19.023438 9.496094 L 18.863281 9.46875 L 18.863281 9.136719 C 18.859375 8.183594 18.714844 7.261719 18.457031 6.527344 C 17.648438 4.253906 15.65625 2.585938 13.152344 2.082031 C 12.574219 1.96875 11.089844 1.96875 10.511719 2.082031 C 8.582031 2.476562 6.984375 3.515625 5.9375 5.058594 C 5.574219 5.601562 5.398438 5.953125 5.183594 6.574219 C 4.933594 7.289062 4.847656 7.789062 4.8125 8.703125 L 4.785156 9.46875 L 4.636719 9.496094 C 4.550781 9.511719 4.398438 9.5625 4.296875 9.613281 C 4.191406 9.664062 4.097656 9.707031 4.089844 9.707031 C 4.074219 9.707031 4.078125 9.253906 4.09375 8.703125 C 4.113281 7.929688 4.140625 7.605469 4.21875 7.257812 C 4.894531 4.277344 7.390625 1.945312 10.460938 1.425781 C 11.183594 1.304688 12.425781 1.300781 13.167969 1.425781 Z M 12.707031 2.535156 C 14.59375 2.777344 16.296875 3.835938 17.324219 5.402344 C 17.957031 6.375 18.25 7.347656 18.316406 8.761719 L 18.351562 9.417969 L 18.105469 9.496094 C 17.8125 9.589844 17.457031 9.878906 17.320312 10.136719 C 17.261719 10.238281 16.9375 11.371094 16.601562 12.644531 C 16.265625 13.917969 15.984375 14.964844 15.972656 14.972656 C 15.964844 14.976562 15.644531 14.996094 15.253906 15.003906 L 14.542969 15.023438 L 14.542969 14.851562 C 14.542969 14.761719 14.5 14.367188 14.449219 13.980469 C 14.355469 13.332031 14.351562 13.277344 14.429688 13.234375 C 14.660156 13.109375 14.773438 12.34375 14.617188 11.972656 C 14.578125 11.886719 14.542969 11.777344 14.542969 11.730469 C 14.542969 11.558594 15.503906 10.339844 16.246094 9.566406 C 16.949219 8.839844 17.265625 8.152344 17.3125 7.261719 C 17.347656 6.65625 17.21875 6.03125 16.988281 5.679688 L 16.84375 5.464844 L 16.585938 5.484375 C 15.644531 5.558594 13.53125 7.257812 12.742188 8.570312 C 12.671875 8.695312 12.546875 8.960938 12.476562 9.167969 C 12.339844 9.546875 12.339844 9.546875 12.160156 9.558594 C 12.058594 9.566406 11.761719 9.5625 11.492188 9.546875 L 11.011719 9.511719 L 10.949219 9.300781 C 10.859375 8.972656 10.535156 8.390625 10.238281 8.003906 C 9.84375 7.503906 8.832031 6.554688 8.304688 6.199219 C 7.445312 5.621094 6.71875 5.34375 6.5 5.523438 C 6.222656 5.746094 6.023438 6.511719 6.058594 7.242188 C 6.101562 8.148438 6.40625 8.808594 7.132812 9.566406 C 7.382812 9.835938 7.714844 10.207031 7.863281 10.394531 C 8.011719 10.585938 8.261719 10.898438 8.417969 11.085938 C 8.804688 11.554688 8.859375 11.6875 8.765625 11.917969 C 8.601562 12.308594 8.710938 13.105469 8.941406 13.234375 C 9.007812 13.265625 9.007812 13.339844 8.929688 13.914062 C 8.875 14.269531 8.832031 14.664062 8.832031 14.792969 L 8.832031 15.023438 L 8.292969 15.003906 C 7.996094 14.996094 7.734375 14.96875 7.707031 14.945312 C 7.683594 14.925781 7.410156 13.9375 7.097656 12.753906 C 6.78125 11.574219 6.496094 10.492188 6.453125 10.359375 C 6.320312 9.96875 5.898438 9.582031 5.460938 9.457031 C 5.390625 9.4375 5.375 9.371094 5.367188 9.054688 C 5.335938 8.113281 5.4375 7.398438 5.707031 6.652344 C 6.484375 4.503906 8.472656 2.910156 10.824219 2.554688 C 11.308594 2.480469 12.214844 2.46875 12.707031 2.535156 Z M 7.320312 5.933594 C 7.910156 6.214844 8.558594 6.683594 9.171875 7.269531 C 10.050781 8.105469 10.609375 8.910156 10.699219 9.480469 C 10.722656 9.628906 10.777344 9.746094 10.828125 9.785156 C 10.953125 9.871094 12.453125 9.875 12.5625 9.789062 C 12.59375 9.765625 12.632812 9.644531 12.648438 9.53125 C 12.691406 9.246094 13.042969 8.570312 13.355469 8.164062 C 13.726562 7.683594 14.703125 6.777344 15.214844 6.425781 C 15.671875 6.113281 16.324219 5.78125 16.570312 5.730469 C 16.683594 5.703125 16.714844 5.722656 16.800781 5.886719 C 16.980469 6.226562 17.054688 6.648438 17.027344 7.222656 C 17 7.796875 16.949219 8 16.65625 8.578125 C 16.515625 8.859375 16.359375 9.066406 16.007812 9.429688 C 15.753906 9.695312 15.390625 10.109375 15.195312 10.351562 C 15.003906 10.589844 14.742188 10.925781 14.601562 11.09375 C 14.46875 11.269531 14.328125 11.492188 14.300781 11.59375 C 14.265625 11.691406 14.203125 11.785156 14.15625 11.800781 C 14.007812 11.84375 13.894531 12.21875 13.894531 12.65625 C 13.894531 12.960938 13.914062 13.074219 13.976562 13.136719 C 14.0625 13.234375 14.257812 14.390625 14.257812 14.832031 C 14.257812 15.074219 14.25 15.082031 14.101562 15.109375 C 13.914062 15.152344 13.824219 15.210938 13.824219 15.304688 C 13.824219 15.355469 13.847656 15.363281 13.910156 15.339844 C 13.953125 15.324219 14.054688 15.296875 14.132812 15.28125 C 14.246094 15.261719 14.261719 15.273438 14.242188 15.34375 C 14.226562 15.394531 14.199219 15.53125 14.179688 15.648438 C 14.160156 15.804688 14.121094 15.875 14.058594 15.894531 C 13.957031 15.925781 13.933594 16.035156 14.019531 16.0625 C 14.058594 16.078125 14.039062 16.160156 13.96875 16.316406 C 13.886719 16.496094 13.84375 16.546875 13.777344 16.527344 C 13.65625 16.496094 13.597656 16.605469 13.695312 16.675781 C 13.765625 16.726562 13.761719 16.75 13.632812 16.917969 C 13.554688 17.023438 13.402344 17.164062 13.296875 17.226562 C 12.867188 17.484375 12.222656 17.691406 11.953125 17.660156 C 11.839844 17.640625 11.832031 17.617188 11.816406 17.398438 C 11.804688 17.199219 11.789062 17.15625 11.71875 17.15625 C 11.609375 17.15625 11.566406 17.246094 11.566406 17.457031 C 11.566406 17.589844 11.546875 17.613281 11.425781 17.640625 C 11.058594 17.71875 10.03125 17.28125 9.757812 16.9375 C 9.582031 16.710938 9.566406 16.652344 9.675781 16.652344 C 9.796875 16.652344 9.726562 16.535156 9.59375 16.523438 C 9.445312 16.503906 9.269531 16.136719 9.359375 16.03125 C 9.421875 15.957031 9.390625 15.871094 9.289062 15.871094 C 9.25 15.871094 9.207031 15.765625 9.171875 15.566406 C 9.140625 15.394531 9.121094 15.253906 9.128906 15.25 C 9.140625 15.238281 9.226562 15.261719 9.320312 15.296875 C 9.421875 15.328125 9.511719 15.339844 9.527344 15.328125 C 9.605469 15.253906 9.527344 15.175781 9.335938 15.128906 L 9.121094 15.078125 L 9.121094 14.769531 C 9.121094 14.296875 9.292969 13.296875 9.40625 13.085938 C 9.59375 12.75 9.476562 11.976562 9.195312 11.769531 C 9.132812 11.726562 9.070312 11.625 9.058594 11.550781 C 9.042969 11.476562 8.921875 11.289062 8.792969 11.128906 C 8.011719 10.144531 7.742188 9.820312 7.355469 9.417969 C 6.71875 8.753906 6.421875 8.164062 6.34375 7.402344 C 6.277344 6.792969 6.394531 6.132812 6.613281 5.804688 C 6.707031 5.671875 6.800781 5.691406 7.320312 5.933594 Z M 5.441406 10 C 5.621094 10.070312 5.890625 10.324219 5.9375 10.464844 C 5.953125 10.515625 6.316406 11.882812 6.75 13.5 C 7.445312 16.117188 7.523438 16.449219 7.453125 16.492188 C 7.011719 16.753906 6.644531 17.015625 6.632812 17.078125 C 6.609375 17.199219 6.699219 17.171875 6.972656 16.980469 C 7.203125 16.8125 7.492188 16.652344 7.558594 16.652344 C 7.601562 16.652344 7.585938 17.058594 7.53125 17.191406 C 7.453125 17.394531 7.253906 17.5625 6.972656 17.664062 C 6.496094 17.835938 6.121094 17.757812 5.851562 17.429688 C 5.742188 17.296875 5.59375 16.792969 4.902344 14.164062 C 4.089844 11.09375 4.019531 10.746094 4.125 10.472656 C 4.28125 10.078125 4.992188 9.820312 5.441406 10 Z M 19.132812 10.074219 C 19.253906 10.128906 19.402344 10.25 19.464844 10.339844 C 19.683594 10.652344 19.660156 10.792969 18.816406 13.992188 C 18.390625 15.59375 18.015625 17.011719 17.976562 17.136719 C 17.898438 17.398438 17.726562 17.578125 17.460938 17.683594 C 16.84375 17.929688 15.96875 17.410156 16.089844 16.859375 C 16.097656 16.800781 16.152344 16.816406 16.378906 16.96875 C 16.644531 17.152344 16.753906 17.199219 16.753906 17.117188 C 16.753906 17.066406 16.46875 16.828125 16.277344 16.714844 C 16.195312 16.671875 16.128906 16.601562 16.128906 16.570312 C 16.128906 16.492188 17.523438 11.179688 17.671875 10.675781 C 17.789062 10.304688 17.992188 10.058594 18.257812 9.980469 C 18.480469 9.917969 18.886719 9.964844 19.132812 10.074219 Z M 4.339844 14.167969 C 4.726562 15.648438 5.058594 16.902344 5.074219 16.945312 C 5.097656 17.027344 5.078125 17.035156 4.8125 17.011719 C 4.285156 16.964844 3.839844 16.695312 3.625 16.285156 C 3.5625 16.164062 3.3125 15.316406 3.070312 14.398438 C 2.660156 12.820312 2.640625 12.714844 2.6875 12.480469 C 2.753906 12.125 2.953125 11.800781 3.210938 11.621094 C 3.457031 11.449219 3.5625 11.402344 3.605469 11.449219 C 3.621094 11.464844 3.949219 12.6875 4.339844 14.167969 Z M 20.335938 11.53125 C 20.761719 11.808594 20.972656 12.183594 20.976562 12.660156 C 20.976562 12.898438 20.878906 13.328125 20.542969 14.582031 C 20.304688 15.492188 20.074219 16.265625 20.015625 16.351562 C 19.78125 16.714844 19.339844 16.964844 18.847656 17.011719 C 18.585938 17.035156 18.566406 17.027344 18.589844 16.945312 C 18.609375 16.902344 18.9375 15.667969 19.320312 14.214844 C 20.113281 11.210938 20.058594 11.40625 20.105469 11.40625 C 20.125 11.40625 20.230469 11.464844 20.335938 11.53125 Z M 8.535156 15.160156 L 8.828125 15.195312 L 8.878906 15.519531 C 8.914062 15.699219 8.933594 15.867188 8.929688 15.894531 C 8.917969 15.9375 8.054688 16.246094 8.027344 16.214844 C 8.011719 16.203125 7.734375 15.199219 7.726562 15.144531 C 7.726562 15.125 8.246094 15.132812 8.535156 15.160156 Z M 15.917969 15.234375 C 15.902344 15.296875 15.832031 15.566406 15.757812 15.835938 C 15.636719 16.285156 15.613281 16.335938 15.527344 16.3125 C 15.453125 16.292969 14.441406 15.957031 14.417969 15.945312 C 14.410156 15.9375 14.488281 15.484375 14.523438 15.285156 C 14.546875 15.171875 14.644531 15.15625 15.5 15.144531 C 15.941406 15.132812 15.945312 15.132812 15.917969 15.234375 Z M 12.574219 18.152344 L 12.574219 18.433594 L 12.398438 18.464844 C 12.296875 18.476562 12.125 18.492188 12.015625 18.492188 L 11.808594 18.492188 L 11.808594 18.261719 C 11.808594 18.0625 11.792969 18.03125 11.710938 18.03125 C 11.628906 18.03125 11.617188 18.0625 11.617188 18.261719 C 11.617188 18.492188 11.617188 18.492188 11.460938 18.492188 C 11.375 18.492188 11.1875 18.476562 11.054688 18.464844 L 10.800781 18.433594 L 10.800781 17.871094 L 12.574219 17.871094 Z M 12.574219 18.152344 "/>
            <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 6.773438 6.246094 C 6.71875 6.34375 6.789062 6.484375 6.894531 6.484375 C 7.007812 6.484375 7.617188 6.910156 8.03125 7.273438 C 8.730469 7.890625 9.488281 8.859375 9.929688 9.695312 C 10.035156 9.894531 10.109375 9.980469 10.171875 9.980469 C 10.386719 9.980469 10.300781 9.722656 9.816406 8.96875 C 9.203125 8.011719 8.292969 7.0625 7.441406 6.476562 C 6.960938 6.148438 6.847656 6.113281 6.773438 6.246094 Z M 6.773438 6.246094 "/>
            <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 16.199219 6.304688 C 15.042969 7.003906 13.886719 8.265625 13.191406 9.582031 C 13.042969 9.867188 13.042969 9.980469 13.191406 9.980469 C 13.257812 9.980469 13.328125 9.894531 13.429688 9.691406 C 13.851562 8.878906 14.8125 7.695312 15.53125 7.113281 C 15.941406 6.78125 16.363281 6.503906 16.488281 6.480469 C 16.558594 6.46875 16.585938 6.425781 16.585938 6.324219 C 16.585938 6.136719 16.488281 6.132812 16.199219 6.304688 Z M 16.199219 6.304688 "/>
            <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 10.109375 16.050781 C 10.054688 16.132812 10.132812 16.214844 10.363281 16.34375 C 10.492188 16.414062 10.714844 16.542969 10.851562 16.632812 C 11.117188 16.804688 11.230469 16.808594 11.230469 16.652344 C 11.230469 16.582031 11.113281 16.480469 10.789062 16.285156 C 10.367188 16.023438 10.167969 15.957031 10.109375 16.050781 Z M 10.109375 16.050781 "/>
            <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 12.648438 16.242188 C 12.191406 16.515625 12.066406 16.632812 12.148438 16.726562 C 12.175781 16.761719 12.222656 16.789062 12.246094 16.789062 C 12.28125 16.789062 13.128906 16.285156 13.234375 16.191406 C 13.320312 16.121094 13.257812 16.007812 13.132812 16.011719 C 13.078125 16.011719 12.859375 16.117188 12.648438 16.242188 Z M 12.648438 16.242188 "/>
            <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 14.835938 17.722656 C 14.796875 17.761719 14.785156 18.332031 14.785156 19.679688 C 14.785156 21.617188 14.804688 21.832031 14.957031 21.707031 C 15.058594 21.628906 15.058594 17.734375 14.957031 17.695312 C 14.921875 17.683594 14.867188 17.695312 14.835938 17.722656 Z M 14.835938 17.722656 "/>
            <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 16.441406 18.269531 C 16.425781 18.304688 16.421875 18.976562 16.425781 19.757812 C 16.441406 20.988281 16.449219 21.183594 16.511719 21.183594 C 16.574219 21.183594 16.585938 20.988281 16.585938 19.714844 C 16.585938 18.578125 16.570312 18.242188 16.527344 18.230469 C 16.492188 18.214844 16.453125 18.234375 16.441406 18.269531 Z M 16.441406 18.269531 "/>
            <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 18.023438 18.277344 C 18.007812 18.308594 18.003906 18.976562 18.007812 19.757812 C 18.023438 20.988281 18.035156 21.183594 18.097656 21.183594 C 18.160156 21.183594 18.167969 20.980469 18.183594 19.695312 C 18.191406 18.386719 18.183594 18.214844 18.121094 18.214844 C 18.078125 18.214844 18.035156 18.242188 18.023438 18.277344 Z M 18.023438 18.277344 "/>
            <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 9.226562 19.695312 C 9.238281 21.027344 9.246094 21.136719 9.328125 21.152344 C 9.402344 21.164062 9.40625 21.074219 9.40625 19.714844 C 9.40625 18.289062 9.40625 18.261719 9.3125 18.261719 C 9.214844 18.261719 9.214844 18.285156 9.226562 19.695312 Z M 9.226562 19.695312 "/>
            <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 14.039062 18.640625 C 14.027344 18.671875 14.019531 19.175781 14.027344 19.757812 C 14.039062 20.664062 14.050781 20.816406 14.113281 20.816406 C 14.175781 20.816406 14.183594 20.664062 14.183594 19.714844 C 14.183594 18.875 14.167969 18.613281 14.125 18.597656 C 14.09375 18.585938 14.054688 18.601562 14.039062 18.640625 Z M 14.039062 18.640625 "/>
            <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 15.632812 18.613281 C 15.613281 18.628906 15.601562 19.125 15.601562 19.714844 C 15.601562 20.632812 15.609375 20.789062 15.671875 20.808594 C 15.714844 20.824219 15.757812 20.808594 15.773438 20.777344 C 15.78125 20.746094 15.789062 20.25 15.78125 19.667969 C 15.769531 18.671875 15.742188 18.503906 15.632812 18.613281 Z M 15.632812 18.613281 "/>
            <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 10.066406 18.65625 C 10.019531 18.703125 10.023438 20.738281 10.070312 20.765625 C 10.089844 20.773438 10.132812 20.769531 10.167969 20.75 C 10.210938 20.722656 10.222656 20.460938 10.214844 19.6875 C 10.199219 18.71875 10.175781 18.550781 10.066406 18.65625 Z M 10.066406 18.65625 "/>
            <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 7.660156 18.707031 C 7.644531 18.726562 7.632812 19.175781 7.632812 19.71875 C 7.632812 20.667969 7.636719 20.699219 7.726562 20.699219 C 7.820312 20.699219 7.824219 20.667969 7.824219 19.714844 C 7.824219 18.914062 7.808594 18.726562 7.757812 18.707031 C 7.71875 18.695312 7.675781 18.695312 7.660156 18.707031 Z M 7.660156 18.707031 "/>
            <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 17.207031 18.730469 C 17.195312 18.761719 17.1875 19.226562 17.195312 19.757812 C 17.207031 20.6875 17.210938 20.722656 17.304688 20.722656 C 17.394531 20.722656 17.398438 20.691406 17.398438 19.710938 C 17.398438 18.785156 17.394531 18.699219 17.3125 18.683594 C 17.269531 18.675781 17.222656 18.699219 17.207031 18.730469 Z M 17.207031 18.730469 "/>
            <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 2.769531 18.753906 C 2.75 18.769531 2.734375 19.191406 2.734375 19.691406 C 2.734375 20.546875 2.742188 20.609375 2.828125 20.652344 C 2.886719 20.679688 3.328125 20.699219 3.9375 20.699219 C 4.546875 20.699219 4.988281 20.679688 5.042969 20.652344 C 5.121094 20.613281 5.136719 20.554688 5.136719 20.273438 L 5.136719 19.945312 L 5.472656 20.261719 L 5.808594 20.582031 L 5.808594 18.796875 L 5.136719 19.429688 L 5.136719 19.132812 C 5.136719 18.960938 5.113281 18.808594 5.078125 18.777344 C 5.015625 18.71875 2.828125 18.695312 2.769531 18.753906 Z M 2.769531 18.753906 "/>
            <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 6.824219 19.695312 C 6.839844 20.585938 6.847656 20.675781 6.925781 20.691406 C 7.003906 20.703125 7.007812 20.636719 7.007812 19.714844 C 7.007812 18.75 7.003906 18.722656 6.910156 18.722656 C 6.816406 18.722656 6.816406 18.746094 6.824219 19.695312 Z M 6.824219 19.695312 "/>
            <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 6.035156 18.980469 C 5.984375 19.03125 5.996094 20.339844 6.042969 20.417969 C 6.066406 20.457031 6.121094 20.46875 6.164062 20.457031 C 6.230469 20.429688 6.238281 20.335938 6.230469 19.703125 C 6.214844 19.089844 6.207031 18.976562 6.144531 18.960938 C 6.101562 18.957031 6.054688 18.960938 6.035156 18.980469 Z M 6.035156 18.980469 "/>
            <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 10.824219 19.007812 C 10.808594 19.042969 10.804688 19.378906 10.808594 19.757812 C 10.824219 20.410156 10.828125 20.445312 10.921875 20.445312 C 11.011719 20.445312 11.015625 20.414062 11.015625 19.710938 C 11.015625 19.046875 11.007812 18.976562 10.929688 18.960938 C 10.886719 18.953125 10.839844 18.976562 10.824219 19.007812 Z M 10.824219 19.007812 "/>
            <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 13.234375 18.984375 C 13.214844 18.996094 13.199219 19.328125 13.199219 19.71875 C 13.199219 20.328125 13.210938 20.433594 13.277344 20.457031 C 13.320312 20.46875 13.371094 20.457031 13.398438 20.417969 C 13.445312 20.347656 13.453125 19.140625 13.410156 19.027344 C 13.382812 18.953125 13.285156 18.929688 13.234375 18.984375 Z M 13.234375 18.984375 "/>
            <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 18.816406 19.714844 C 18.816406 20.414062 18.820312 20.472656 18.902344 20.460938 C 18.972656 20.445312 18.984375 20.367188 19 19.695312 C 19.007812 18.976562 19.007812 18.953125 18.910156 18.953125 C 18.820312 18.953125 18.816406 18.980469 18.816406 19.714844 Z M 18.816406 19.714844 "/>
            <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 8.425781 19.097656 C 8.410156 19.136719 8.40625 19.429688 8.410156 19.761719 C 8.425781 20.316406 8.429688 20.355469 8.519531 20.355469 C 8.609375 20.355469 8.617188 20.324219 8.617188 19.710938 C 8.617188 19.136719 8.605469 19.066406 8.53125 19.054688 C 8.488281 19.042969 8.4375 19.066406 8.425781 19.097656 Z M 8.425781 19.097656 "/>
            <path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 19.609375 19.289062 C 19.59375 19.320312 19.585938 19.535156 19.59375 19.761719 C 19.609375 20.132812 19.617188 20.171875 19.703125 20.171875 C 19.796875 20.171875 19.800781 20.140625 19.800781 19.710938 C 19.800781 19.3125 19.789062 19.25 19.714844 19.238281 C 19.671875 19.226562 19.621094 19.25 19.609375 19.289062 Z M 19.609375 19.289062 "/>
          </g>
        </svg>
    </div>
    `;

  observeDom(function ({ $group, $image }) {
    const findVideo = videoList.find(function (video) {
      return $image.src.indexOf(video.photo) > -1;
    });
    const checkExtensionButton = $group.getAttribute(
      "data-twitter-video-downloader-extension"
    );
    if (findVideo && !checkExtensionButton) {
      $group.setAttribute("data-twitter-video-downloader-extension", "true");
      const { width, height } = $group
        .querySelector("svg")
        .getBoundingClientRect();

      const $button = document.createElement("button");
      $button.classList.add("extension-button");
      $button.setAttribute("role", "button");
      $button.setAttribute("title", "Open with cut-audio-from-video.com");

      $button.insertAdjacentHTML("beforeend", svgElement);
      $group.appendChild($button);
      $button.addEventListener("click", async function (event) {
        event.preventDefault();
        this.disabled = true;
        // this.classList.add("loading");
        const mixedVideos = videoList
          .filter(function (v) {
            return v.entityId === findVideo.entityId;
          })
          .filter(function (value, index, self) {
            return (
              index ===
              self.findIndex(function (find) {
                return find.id === value.id;
              })
            );
          });
        for (const video of mixedVideos) {
          await downloadVideo(video.video, video.text);
        }
        // this.classList.remove("loading");
        // this.classList.add("success");
      });
    }
  });
}

twitterDownloaderMain();
